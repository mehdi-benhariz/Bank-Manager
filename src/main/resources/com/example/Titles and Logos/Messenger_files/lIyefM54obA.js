if (self.CavalryLogger) { CavalryLogger.start_js_script(document.currentScript); }/*FB_PKG_DELIM*/

__d("LSIssueShadowMessageBackupTask",["LSAppendDataTraceAddon","LSCreateDataTraceID.bs","LSIssueNewTaskAndGetTaskID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(e){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssueShadowMessageBackupTaskStoredProcedure]Beginning execution."),d[0]=c.i64.random(),c.islc(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,[0,80])&&c.i64.eq(a.backupTenancy,[0,2])}),0,c.i64.to_float([0,1])).next().then(function(e,g){g=e.done;e=e.value;return g?function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssueShadowMessageBackupTaskStoredProcedure]No shadow backup row found in client state table."):(e.item,c.seq([function(a){return d[2]=c.i64.of_float(Date.now()),c.islc(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,[0,80])&&c.i64.eq(a.backupTenancy,[0,2])}),0,c.i64.to_float([0,1])).next().then(function(a,b){b=a.done;a=a.value;return b?d[3]=!1:(a.item,d[3]=!0)})},function(a){return d[3]?d[5]=c.i64.or_([0,72],[0,128]):d[5]=[0,72],c.nop(b("LSCreateDataTraceID.bs")).then(function(a){return a=a,d[6]=a[0],a})},function(a){return d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils]",d[7],"EncryptedBackups Trace ID",d[7],c.i64.to_string(d[5])].join("")),c.db.table(153).add({traceId:d[6],initTimestampMs:c.i64.of_float(Date.now()),traceType:d[5],shouldFlush:!1,contextThree:"backup_upload"})},function(a){return d[6]!==f?c.sp(b("LSAppendDataTraceAddon"),d[6],[0,1427],[0,2],f,f):c.resolve()},function(a){return c.sp(b("LSIssueNewTaskAndGetTaskID"),"encrypted_backups_upload",[0,319],"",f,f,[0,0],[0,0],f,f,c.i64.add(d[2],c.i64.sub([0,6e4],c.i64.mod_(d[2],[0,6e4])))).then(function(a){return a=a,d[8]=a[0],a})},function(b){return c.db.table(177).add({pk:void 0,pendingBackupTaskId:d[8],persistentId:"",actionType:[0,1],contentType:[0,1],backupStatus:[0,1],listKey:c.i64.to_string(a[0]),uniqueKey:c.i64.to_string(a[1]),sortKey:c.i64.to_string(c.i64.add([255,4294967295],c.i64.and_(d[0],[255,4294967295]))),echoContent:a[2],lsTraceId:d[6]})}]))})},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssueShadowMessageBackupTaskStoredProcedure]Finishing execution.")}])},function(a){return c.resolve(e)}])}e.exports=a}),null);